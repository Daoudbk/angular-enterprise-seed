'use strict';


myApp.factory('ScrollService', function ($rootScope) {

    var sharedService = {};

    sharedService.message = '';

    sharedService.prepForBroadcast = function (msg) {
        this.message = msg;
        this.broadcastItem();
    };

    sharedService.broadcastItem = function () {
        $rootScope.$broadcast('handleBroadcast');
    };

    return sharedService;
});


// generic rest service (stopgap for early development)
// TODO implement a full rest client to support two-way binding with server
// TODO what is the difference between $http and $resource ?
myApp.factory('RESTService',
    function ($http) {
        return {
            get:function (url, callback) {
                return $http({method:'GET', url:url}).
                    success(function (data, status, headers, config) {
                        callback(data);
                        //console.log(data.json);
                    }).
                    error(function (data, status, headers, config) {
                        console.log("failed to retrieve data");
                    });
            }
        };
    }
);

myApp.factory('CreateCardService',

    function () {

        var selectedImageJSON = "";
        var selectedImageUrl = "";
        var defaultCardHTML = "<strong>Thank you,</strong><br><br>We appreciate your business.<br><br>Sincerely,<br><br>Jim Robbins,<br><i>Kingston Rotary</i>";
        var cardHTML = defaultCardHTML;
        var defaultAddressList = "wendy@artcardsforcauses.com, jessie@artcardsforcauses.com";
        var addressList = defaultAddressList;
        var fullHTML = "html";

        return {
            setFullHTML:function (html) {
                console.log("setting html " + html);
                fullHTML = html;
            },
            getFullHTML:function () {
                return fullHTML;
            },
            getAddressList:function () {
                return addressList;
            },
            setSelectedImage:function (json, url) {
                selectedImageJSON = json;
                selectedImageUrl = url;
            },
            getSelectedImageUrl:function () {
                return selectedImageUrl;
            },
            getCardHTML:function () {
                return cardHTML;
            },
            setCardHTML:function (html) {
                cardHTML = html;
            }
        };
    }
);


myApp.factory('AuthService',
    function () {
        var currentUser = null;
        var authorized = false;

        // initial state says we haven't logged in or out yet...
        // this tells us we are in public browsing
        var initialState = true;

        return {
            initialState:function () {
                return initialState;
            },
            login:function (name, password) {
                currentUser = name;
                authorized = true;
                //console.log("Logged in as " + name);
                initialState = false;
            },
            logout:function () {
                currentUser = null;
                authorized = false;
            },
            isLoggedIn:function () {
                return authorized;
            },
            currentUser:function () {
                return currentUser;
            },
            authorized:function () {
                return authorized;
            }
        };
    }
);

